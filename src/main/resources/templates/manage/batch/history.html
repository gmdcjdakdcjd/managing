<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<head>
    <meta charset="UTF-8">
    <title>Î∞∞Ïπò Ïã§Ìñâ Ïù¥Î†•</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>


<body>

<div layout:fragment="content" class="container mt-4" style="max-width:1200px;">

    <h3 class="fw-bold mb-4">üß© Î∞∞Ïπò Ïã§Ìñâ Ïù¥Î†•</h3>

    <div class="card">
        <div class="card-header fw-semibold">Ï†ÑÏ≤¥ Î∞∞Ïπò ÎÇ¥Ïó≠</div>

        <div class="card-body">

            <table class="table table-hover text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th>ÎÇ†Ïßú</th>
                    <th>Í±¥Ïàò(IN+OUT)</th>
                    <th>ÏÉÅÏÑ∏Î≥¥Í∏∞</th>
                </tr>
                </thead>

                <tbody>

                <!-- üî• ÎÇ†Ïßú + ÏÉÅÏÑ∏ Î•º ÌïòÎÇòÏùò Î∞òÎ≥µÏúºÎ°ú Î¨∂Ïùå -->
                <th:block th:each="g : ${groups}">

                    <!-- üìå ÎÇ†Ïßú row -->
                    <tr>
                        <td th:text="${g.date}"></td>
                        <td th:text="${#lists.size(g.items)} + 'Í±¥'"></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary fw-semibold"
                                    th:attr="data-id=${g.dateKey}"
                                    onclick="toggleDetail(this)">
                                Î≥¥Í∏∞ ‚ñº
                            </button>
                        </td>
                    </tr>

                    <!-- üìå ÏÉÅÏÑ∏ row (Ìï¥Îãπ ÎÇ†Ïßú Î∞îÎ°ú ÏïÑÎûò) -->
                    <tr th:id="|detail-${g.dateKey}|" class="detail-row" style="display:none;">
                        <td colspan="3">

                            <div class="p-3 border rounded bg-light">

                                <h5 class="fw-bold mb-3">ÏÉÅÏÑ∏ Ïã§Ìñâ ÎÇ¥Ïó≠</h5>

                                <table class="table table-sm table-bordered text-center mb-0">
                                    <thead class="table-secondary">
                                    <tr>
                                        <th>Ïú†Ìòï</th>
                                        <th>JobÎ™Ö</th>
                                        <th>ÏãúÏûë</th>
                                        <th>Ï¢ÖÎ£å</th>
                                        <th>Status</th>
                                        <th>Duration(ms)</th>
                                    </tr>
                                    </thead>

                                    <tbody>
                                    <tr th:each="item : ${g.items}">
                                        <td th:text="${item.type}"></td>
                                        <td th:text="${item.jobName}"></td>

                                        <td th:text="${#temporals.format(item.execStartTime,'yyyy-MM-dd HH:mm:ss')}"></td>
                                        <td th:text="${#temporals.format(item.execEndTime,'yyyy-MM-dd HH:mm:ss')}"></td>

                                        <td th:text="${item.execStatus}"
                                            th:classappend="${item.execStatus == 'SUCCESS'}
                                                            ? 'text-success fw-bold'
                                                            : 'text-danger fw-bold'">
                                        </td>

                                        <td th:text="${item.durationMs}"></td>
                                    </tr>
                                    </tbody>

                                </table>

                            </div>

                        </td>
                    </tr>

                </th:block>

                </tbody>
            </table>

        </div>
    </div>

</div>


<!-- ============================ -->
<!-- Toggle Script -->
<!-- ============================ -->
<th:block layout:fragment="script">
    <script th:inline="javascript">

        function toggleDetail(btn) {

            const id = btn.getAttribute("data-id");
            const row = document.getElementById("detail-" + id);

            const hidden = row.style.display === "none" || row.style.display === "";

            if (hidden) {
                row.style.display = "table-row";
                btn.textContent = "Îã´Í∏∞ ‚ñ≤";
            } else {
                row.style.display = "none";
                btn.textContent = "Î≥¥Í∏∞ ‚ñº";
            }
        }

    </script>
</th:block>

</body>
</html>
