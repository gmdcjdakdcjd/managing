<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<head>
    <meta charset="UTF-8">
    <title>ì „ëµ ê²°ê³¼ ëª©ë¡ (KR)</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>

<body>
<div layout:fragment="content" class="container mt-4" style="max-width:1400px;">

    <h3 class="fw-bold mb-4">ğŸ“ˆ í•œêµ­ ì „ëµ ê²°ê³¼ ëª©ë¡</h3>

    <!-- ì „ëµëª… í•„í„° -->
    <!-- ğŸ” ì „ëµëª… + ë‚ ì§œ + ê²€ìƒ‰/ì´ˆê¸°í™” í•„í„° -->
    <form id="filterForm" action="/board/listKR" method="get" class="mb-3">

        <div class="d-flex flex-wrap align-items-center justify-content-between">

            <!-- ì™¼ìª½ : ì „ëµëª… + ë‚ ì§œ -->
            <div class="d-flex gap-3 flex-wrap">

                <!-- ğŸ“Œ ì „ëµëª… -->
                <div class="input-group" style="width: 300px;">
                    <span class="input-group-text bg-primary text-white">ì „ëµëª…</span>
                    <select name="strategy" class="form-select">
                        <option value="">ì „ì²´</option>
                        <option th:each="s : ${strategyList}"
                                th:value="${s.code}"
                                th:text="${s.label}"
                                th:selected="${strategy == s.code}">
                        </option>
                    </select>
                </div>

                <!-- ğŸ“… ë‚ ì§œ -->
                <div class="input-group" style="width: 220px;">
                    <span class="input-group-text bg-secondary text-white">ë‚ ì§œ</span>
                    <input type="date" class="form-control" name="regDate" th:value="${regDate}">
                </div>

            </div>

            <!-- ğŸ” ì˜¤ë¥¸ìª½ : ê²€ìƒ‰ / ì´ˆê¸°í™” -->
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success px-3 fw-semibold">
                    ê²€ìƒ‰
                </button>

                <a href="/board/listKR" class="btn btn-outline-danger px-3 fw-semibold">
                    ì´ˆê¸°í™”
                </a>
            </div>

        </div>

        <!-- í˜ì´ì§• ìœ ì§€ -->
        <input type="hidden" name="page" th:value="${pageRequestDTO.page}">
        <input type="hidden" name="size" th:value="${pageRequestDTO.size}">
    </form>




    <!-- ================================ -->
    <!-- ğŸ“Œ í˜ì´ì§€ ì´ë™ìš© form -->
    <!-- ================================ -->
    <form id="pageForm" action="/board/listKR" method="get">
        <input type="hidden" name="page" th:value="${pageRequestDTO.page}">
        <input type="hidden" name="size" th:value="${pageRequestDTO.size}">
        <!-- ê²€ìƒ‰ê°’ ìœ ì§€ (ì˜µì…˜) -->
        <input type="hidden" name="type" th:value="${pageRequestDTO.type}">
        <input type="hidden" name="keyword" th:value="${pageRequestDTO.keyword}">
        <input type="hidden" name="regDate" th:value="${pageRequestDTO.regDate}">
    </form>

    <!-- ================================ -->
    <!-- ğŸ“Œ ì „ëµ ê²°ê³¼ í…Œì´ë¸” -->
    <!-- ================================ -->
    <div class="card">
        <div class="card-header fw-semibold">ì „ëµ ê²°ê³¼</div>

        <div class="card-body">

            <table class="table table-hover text-center">
                <thead class="table-light">
                <tr>
                    <th>ì „ëµëª…</th>
                    <th>í¬ì°©ì¼</th>
                    <th>í¬ì°© ë°ì´í„° ìˆ˜</th>
                    <th>ìƒì„±ì¼</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="dto : ${responseDTO.dtoList}"
                    class="result-row"
                    th:data-strategy="${dto.strategyName}"
                    th:data-date="${dto.signalDate}"
                    style="cursor:pointer;">

                    <td th:text="${T(com.stock.managing.enums.StrategyCode).findByCode(dto.strategyName).label}"></td>

                    <td th:text="${dto.signalDate}"></td>
                    <td th:text="${dto.totalData}"></td>
                    <td th:text="${dto.createdAt}"></td>

                </tr>
                </tbody>

            </table>

            <!-- ================================ -->
            <!-- ğŸ“Œ Pagination -->
            <!-- ================================ -->
            <div class="text-center mt-3">
                <ul class="pagination justify-content-center flex-wrap">

                    <li class="page-item" th:if="${responseDTO.prev}">
                        <a class="page-link"
                           th:data-num="${responseDTO.start - 1}">Previous</a>
                    </li>

                    <th:block th:each="i : ${#numbers.sequence(responseDTO.start, responseDTO.end)}">
                        <li th:class="${responseDTO.page == i} ? 'page-item active' : 'page-item'">
                            <a class="page-link" th:data-num="${i}">[[${i}]]</a>
                        </li>
                    </th:block>

                    <li class="page-item" th:if="${responseDTO.next}">
                        <a class="page-link"
                           th:data-num="${responseDTO.end + 1}">Next</a>
                    </li>

                </ul>
            </div>

        </div>
    </div>

</div>

<!-- ================================ -->
<!-- ğŸ“Œ Script -->
<!-- ================================ -->
<script layout:fragment="script" th:inline="javascript">

    /* í–‰ í´ë¦­ â†’ ìƒì„¸ */
    document.querySelectorAll(".result-row").forEach(row => {
        row.addEventListener("click", function () {
            const strategy = this.dataset.strategy;
            const date = this.dataset.date;
            window.location.href = `/board/detailKR?strategy=${strategy}&date=${date}`;
        });
    });

    /* í˜ì´ì§€ ì´ë™ */
    const pagination = document.querySelector(".pagination");
    const pageForm = document.getElementById("pageForm");

    if (pagination) {
        pagination.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            const target = e.target;
            if (target.tagName !== 'A') return;

            const num = target.getAttribute("data-num");

            pageForm.querySelector("input[name='page']").value = num;
            pageForm.submit();
        });
    }

</script>


</body>
</html>
