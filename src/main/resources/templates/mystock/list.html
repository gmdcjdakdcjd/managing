<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<head>
    <meta charset="UTF-8">
    <title>ÎÇ¥ Ï¢ÖÎ™©</title>

    <style>
        .card-box {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 1.2rem;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        table th, table td {
            vertical-align: middle;
            font-size: 0.92rem;
        }
    </style>
</head>

<body>

<div layout:fragment="content" class="container mt-4" style="max-width:1400px;">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold">‚≠ê ÎÇ¥ Í¥ÄÏã¨ Ï¢ÖÎ™©</h3>

        <button class="btn btn-outline-secondary btn-sm"
                onclick="openHistoryModal()">
            üïë ÏÇ≠Ï†úÎêú Ï¢ÖÎ™© Î≥¥Í∏∞
        </button>
    </div>

    <!-- üá∞üá∑ ÌïúÍµ≠ Í¥ÄÏã¨ Ï¢ÖÎ™© -->
    <div th:if="${#lists.size(krList) > 0}">
        <h4 class="fw-bold mt-4">üá∞üá∑ ÌïúÍµ≠ Í¥ÄÏã¨ Ï¢ÖÎ™©</h4>

        <div class="card card-box mb-5">
            <table class="table table-hover text-center table-sm">
                <thead class="table-light">
                <tr>
                    <th>No</th>
                    <th>Ï¢ÖÎ™©ÏΩîÎìú</th>
                    <th>Ï¢ÖÎ™©Î™Ö</th>
                    <th>ÌòÑÏû¨Í∞Ä</th>
                    <th>Ï∂îÍ∞Ä ÎãπÏãú Í∞ÄÍ≤©</th>
                    <th>+5%</th>
                    <th>+10%</th>
                    <th>Ìè¨Ï∞© Ï†ÑÎûµ</th>
                    <th>Îì±Î°ùÏùº</th>
                    <th>ÏÇ≠Ï†ú</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="s, idx : ${krList}">
                    <td th:text="${idx.index + 1}"></td>
                    <td th:text="${s.code}"></td>
                    <td th:text="${s.name}"></td>

                    <!-- ÌòÑÏû¨Í∞Ä -->
                    <td th:text="${#numbers.formatInteger(s.currentPrice, 0, 'COMMA') + ' Ïõê'}"></td>
                    <td th:text="${#numbers.formatInteger(s.priceAtAdd, 0, 'COMMA') + ' Ïõê'}"></td>
                    <td th:text="${#numbers.formatInteger(s.targetPrice5, 0, 'COMMA') + ' Ïõê'}"></td>
                    <td th:text="${#numbers.formatInteger(s.targetPrice10, 0, 'COMMA') + ' Ïõê'}"></td>

                    <td>
                        <span th:text="${s.strategyName}"></span>
                        <a th:href="@{'/board/detailKR'(strategy=${s.strategyName}, date=${s.memo})}">
                            üîç
                        </a>
                    </td>

                    <td th:text="${#temporals.format(s.createdAt, 'yyyy-MM-dd')}"></td>

                    <td>
                        <button class="btn btn-sm btn-outline-danger"
                                th:onclick="'deleteMyStock(' + ${s.id} + ')'">
                            ÏÇ≠Ï†ú
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- üá∫üá∏ ÎØ∏Íµ≠ Í¥ÄÏã¨ Ï¢ÖÎ™© -->
    <div th:if="${#lists.size(usList) > 0}">
        <h4 class="fw-bold mt-4">üá∫üá∏ ÎØ∏Íµ≠ Í¥ÄÏã¨ Ï¢ÖÎ™©</h4>

        <div class="card card-box mb-5">
            <table class="table table-hover text-center table-sm">
                <thead class="table-light">
                <tr>
                    <th>No</th>
                    <th>Ï¢ÖÎ™©ÏΩîÎìú</th>
                    <th>Ï¢ÖÎ™©Î™Ö</th>
                    <th>ÌòÑÏû¨Í∞Ä</th>
                    <th>Ï∂îÍ∞Ä ÎãπÏãú Í∞ÄÍ≤©</th>
                    <th>+5%</th>
                    <th>+10%</th>
                    <th>Ìè¨Ï∞© Ï†ÑÎûµ</th>
                    <th>Îì±Î°ùÏùº</th>
                    <th>ÏÇ≠Ï†ú</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="s, idx : ${usList}">
                    <td th:text="${idx.index + 1}"></td>
                    <td th:text="${s.code}"></td>
                    <td th:text="${s.name}"></td>

                    <!-- ÌòÑÏû¨Í∞Ä -->
                    <td th:text="${s.currentPrice + ' $'}"></td>
                    <td th:text="${s.priceAtAdd + ' $'}"></td>
                    <td th:text="${s.targetPrice5 + ' $'}"></td>
                    <td th:text="${s.targetPrice10 + ' $'}"></td>


                    <td>
                        <span th:text="${s.strategyName}"></span>
                        <a th:href="@{'/board/detailUS'(strategy=${s.strategyName}, date=${s.memo})}">
                            üîç
                        </a>
                    </td>

                    <td th:text="${#temporals.format(s.createdAt, 'yyyy-MM-dd')}"></td>

                    <td>
                        <button class="btn btn-sm btn-outline-danger"
                                th:onclick="'deleteMyStock(' + ${s.id} + ')'">
                            ÏÇ≠Ï†ú
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ÏÇ≠Ï†ú Î™®Îã¨ -->
    <div class="modal fade" id="historyModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">üïë ÏÇ≠Ï†úÎêú Í¥ÄÏã¨ Ï¢ÖÎ™©</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <table class="table table-sm table-hover text-center">
                        <thead class="table-light">
                        <tr>
                            <th>No</th>
                            <th>Ï¢ÖÎ™©ÏΩîÎìú</th>
                            <th>Ï¢ÖÎ™©Î™Ö</th>
                            <th>ÏÇ≠Ï†úÏùº</th>
                            <th>Î≥µÍµ¨</th>
                        </tr>
                        </thead>
                        <tbody id="deletedListBody"></tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="script">
    <script th:inline="javascript">

        document.addEventListener("DOMContentLoaded", function () {

            window.deleteMyStock = function (id) {
                if (!confirm("ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

                fetch("/mystock/delete/" + id, {method: "POST"})
                    .then(res => res.json())
                    .then(() => {
                        alert("ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§");
                        location.reload();
                    });
            }

            window.openHistoryModal = function () {
                fetch("/mystock/deleted")
                    .then(res => res.json())
                    .then(list => {

                        const tbody = document.getElementById("deletedListBody");
                        tbody.innerHTML = "";

                        list.forEach((s, idx) => {
                            tbody.innerHTML += `
                            <tr>
                                <td>${idx + 1}</td>
                                <td>${s.code}</td>
                                <td>${s.name}</td>
                                <td>${s.deletedAt.replace("T", " ")}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary"
                                        onclick="restoreMyStock(${s.id})">
                                        Î≥µÍµ¨
                                    </button>
                                </td>
                            </tr>`;
                        });

                        new bootstrap.Modal(document.getElementById("historyModal")).show();
                    });
            }

            window.restoreMyStock = function (id) {
                if (!confirm("Î≥µÍµ¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

                fetch("/mystock/restore/" + id, {method: "POST"})
                    .then(res => res.json())
                    .then(() => {
                        alert("Î≥µÍµ¨ÎêòÏóàÏäµÎãàÎã§!");

                        let modal = bootstrap.Modal.getInstance(document.getElementById("historyModal"));
                        modal.hide();
                        setTimeout(() => location.reload(), 200);
                    });
            }
        });

    </script>
</th:block>

</body>
</html>
